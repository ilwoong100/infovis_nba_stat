<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA 5Ïù∏ ÎùºÏù∏ÏóÖ Î∂ÑÏÑù</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .main-content {
            display: flex;
            gap: 30px;
        }

        .left-panel {
            flex: 1;
            min-width: 400px;
        }

        .right-panel {
            flex: 1;
            min-width: 600px;
        }

        .player-table {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .player-table h3 {
            margin: 0 0 15px 0;
            color: #333;
            text-align: center;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .search-box:focus {
            outline: none;
            border-color: #007bff;
        }

        .player-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .player-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        .player-item:hover {
            background: #f0f8ff;
        }

        .player-item.selected {
            background: #e3f2fd;
        }

        .player-checkbox {
            margin-right: 10px;
            cursor: pointer;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #333;
        }

        .player-details {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        .position-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }

        .pos-PG { background-color: #FF6B6B; }
        .pos-SG { background-color: #4ECDC4; }
        .pos-SF { background-color: #45B7D1; }
        .pos-PF { background-color: #96CEB4; }
        .pos-C { background-color: #FFEAA7; color: #333; }

        .selected-lineup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
        }

        .selected-lineup h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }

        .selected-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #ffeaa7;
        }

        .selected-player:last-child {
            border-bottom: none;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .radar-container {
            text-align: center;
        }

        .radar-chart {
            margin: 0 auto;
        }

        .analysis-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .analysis-panel h4 {
            margin: 0 0 15px 0;
            color: #333;
        }

        .strength-weakness {
            display: flex;
            gap: 20px;
        }

        .strength, .weakness {
            flex: 1;
            padding: 15px;
            border-radius: 5px;
        }

        .strength {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }

        .weakness {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }

        .strength h5, .weakness h5 {
            margin: 0 0 10px 0;
            color: #155724;
        }

        .weakness h5 {
            color: #721c24;
        }

        .stat-comparison {
            margin-top: 15px;
        }

        .stat-bar {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }

        .stat-label {
            width: 80px;
            font-size: 12px;
            font-weight: bold;
        }

        .stat-progress {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .stat-value {
            width: 50px;
            text-align: right;
            font-size: 12px;
            font-weight: bold;
        }

        .radar-path {
            fill: rgba(54, 162, 235, 0.2);
            stroke: rgba(54, 162, 235, 1);
            stroke-width: 2;
        }

        .radar-path.league-average {
            fill: rgba(255, 99, 132, 0.1);
            stroke: rgba(255, 99, 132, 0.8);
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .radar-axis {
            stroke: #999;
            stroke-width: 1;
        }

        .radar-grid {
            stroke: #ddd;
            stroke-width: 1;
            fill: none;
        }

        .radar-label {
            font-size: 12px;
            font-weight: bold;
            fill: #333;
            text-anchor: middle;
        }

        .legend {
            text-align: center;
            margin-top: 15px;
        }

        .legend-item {
            display: inline-block;
            margin: 0 15px;
            font-size: 14px;
        }

        .legend-line {
            display: inline-block;
            width: 20px;
            height: 3px;
            margin-right: 5px;
            vertical-align: middle;
        }

        .team-avg { background-color: rgba(54, 162, 235, 1); }
        .league-avg { 
            background: repeating-linear-gradient(
                90deg,
                rgba(255, 99, 132, 0.8) 0px,
                rgba(255, 99, 132, 0.8) 3px,
                transparent 3px,
                transparent 6px
            );
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÄ NBA 5Ïù∏ ÎùºÏù∏ÏóÖ Îä•Î†•Ïπò Î∂ÑÏÑù</h1>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="player-table">
                    <h3>ÏÑ†Ïàò ÏÑ†ÌÉù (ÏµúÎåÄ 5Î™Ö)</h3>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="text" class="search-box" id="playerSearch" placeholder="ÏÑ†Ïàò Ïù¥Î¶Ñ ÎòêÎäî ÌåÄÏúºÎ°ú Í≤ÄÏÉâ... (Ïòà: LeBron, LAL)" style="flex: 1;">
                        <select id="teamSelect" style="padding: 10px; border: 2px solid #ddd; border-radius: 5px; background: white; cursor: pointer;">
                            <option value="">ÌåÄÎ≥Ñ ÏÉÅÏúÑ 5Î™Ö</option>
                        </select>
                    </div>
                    
                    <div class="player-list" id="playerList"></div>
                </div>
                
                <div class="selected-lineup">
                    <h4>ÏÑ†ÌÉùÎêú ÎùºÏù∏ÏóÖ (<span id="selectedCount">0</span>/5)</h4>
                    <div style="margin-bottom: 10px;">
                        <button style="padding: 5px 10px; background: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;" onclick="clearSelection()">Ï†ÑÏ≤¥ Ìï¥Ï†ú</button>
                    </div>
                    <div id="selectedPlayers"></div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="radar-container">
                    <h3>ÌåÄ Îä•Î†•Ïπò Î†àÏù¥Îçî Ï∞®Ìä∏</h3>
                    <svg class="radar-chart" id="radarChart"></svg>
                    <div class="legend">
                        <div class="legend-item">
                            <span class="legend-line team-avg"></span>
                            ÏÑ†ÌÉùÎêú ÌåÄ ÌèâÍ∑†
                        </div>
                        <div class="legend-item">
                            <span class="legend-line league-avg"></span>
                            Ï†ÑÏ≤¥ ÌåÄ Ï£ºÏ†Ñ5 ÌèâÍ∑† (Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§Ä)
                        </div>
                    </div>
                </div>
                
                <div class="analysis-panel">
                    <h4>üìä ÎùºÏù∏ÏóÖ Î∂ÑÏÑù</h4>
                    <div class="strength-weakness">
                        <div class="strength">
                            <h5>üí™ Í∞ïÏ†ê</h5>
                            <div id="strengthAnalysis">ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</div>
                        </div>
                        <div class="weakness">
                            <h5>‚ö†Ô∏è ÏïΩÏ†ê</h5>
                            <div id="weaknessAnalysis">ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</div>
                        </div>
                    </div>
                    
                    <div class="stat-comparison">
                        <h5>Ï†ÑÏ≤¥ ÌåÄ Ï£ºÏ†Ñ5 ÌèâÍ∑† ÎåÄÎπÑ Îä•Î†•Ïπò (Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§Ä)</h5>
                        <div id="statBars"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // D3.js Ïä§ÌÉÄÏùº Ï†ÑÏó≠ ÏÑ§Ï†ï
        const radarSize = 300;
        const radarRadius = 120;
        const radarCenter = radarSize / 2;

        // Î†àÏù¥Îçî Ï∞®Ìä∏ ÏÑ§Ï†ï
        const svg = d3.select("#radarChart")
            .attr("width", radarSize)
            .attr("height", radarSize);

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let allPlayers = [];
        let selectedPlayers = [];
        let filteredPlayers = [];

        // Îä•Î†•Ïπò Ï†ïÏùò
        const stats = [
            { key: 'pts', label: 'ÎìùÏ†ê', max: 35 },
            { key: 'ast', label: 'Ïñ¥ÏãúÏä§Ìä∏', max: 12 },
            { key: 'trb', label: 'Î¶¨Î∞îÏö¥Îìú', max: 15 },
            { key: 'stl', label: 'Ïä§Ìã∏', max: 3 },
            { key: 'blk', label: 'Î∏îÎ°ù', max: 3 }
        ];

        // Î¶¨Í∑∏ ÌèâÍ∑† (Í∞Å ÌåÄÎ≥Ñ Î≤†Ïä§Ìä∏ 5Ïùò ÌèâÍ∑†ÏúºÎ°ú Í≥ÑÏÇ∞)
        let leagueAverage = {};

        // Í∞Å ÌåÄÎ≥Ñ Î≤†Ïä§Ìä∏ 5 ÌèâÍ∑† Í≥ÑÏÇ∞ (Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§Ä)
        function calculateLeagueAverage() {
            const teamGroups = d3.group(allPlayers, d => d.Team);
            const teamAverages = [];
            
            // Í∞Å ÌåÄÎ≥Ñ Ï∂úÏ†ÑÏãúÍ∞Ñ ÏÉÅÏúÑ 5Î™ÖÏùò ÌèâÍ∑† Í≥ÑÏÇ∞
            Array.from(teamGroups.entries()).forEach(([team, players]) => {
                const top5 = players
                    .sort((a, b) => b.avgMP - a.avgMP)  // ÌèâÍ∑† Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÎ†¨
                    .slice(0, 5);
                
                if (top5.length >= 3) {  // ÏµúÏÜå 3Î™Ö Ïù¥ÏÉÅÏù∏ ÌåÄÎßå Ìè¨Ìï®
                    const teamAvg = {
                        team: team,
                        pts: d3.mean(top5, d => d.pts),
                        ast: d3.mean(top5, d => d.ast),
                        trb: d3.mean(top5, d => d.trb),
                        stl: d3.mean(top5, d => d.stl),
                        blk: d3.mean(top5, d => d.blk),
                        avgMP: d3.mean(top5, d => d.avgMP)
                    };
                    teamAverages.push(teamAvg);
                }
            });
            
            // Î™®Îì† ÌåÄÎì§Ïùò Ï£ºÏ†Ñ 5Î™Ö ÌèâÍ∑†ÏùÑ Îã§Ïãú ÌèâÍ∑†ÎÇ¥Í∏∞
            leagueAverage = {
                pts: d3.mean(teamAverages, d => d.pts),
                ast: d3.mean(teamAverages, d => d.ast),
                trb: d3.mean(teamAverages, d => d.trb),
                stl: d3.mean(teamAverages, d => d.stl),
                blk: d3.mean(teamAverages, d => d.blk)
            };
            
            console.log("ÌåÄÎ≥Ñ Ï£ºÏ†Ñ 5Î™Ö ÎùºÏù∏ÏóÖ ÌèâÍ∑† (Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§Ä):", leagueAverage);
            console.log("ÌèâÍ∑† Ï∂úÏ†ÑÏãúÍ∞Ñ:", d3.mean(teamAverages, d => d.avgMP).toFixed(1), "Î∂Ñ");
        }

        // ÏÉâÏÉÅ Ïä§ÏºÄÏùº
        const colorScale = d3.scaleOrdinal()
            .domain(['PG', 'SG', 'SF', 'PF', 'C'])
            .range(['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7']);


        // ÌåÄ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥ ÏÑ§Ï†ï
        function setupTeamSelect() {
            // ÌåÄÎ≥Ñ Í∑∏Î£πÌïë
            const teamGroups = d3.group(allPlayers, d => d.Team);
            const teams = Array.from(teamGroups.keys()).sort();
            
            const teamSelect = d3.select("#teamSelect");
            
            teamSelect.selectAll("option.team-option")
                .data(teams)
                .join("option")
                .attr("class", "team-option")
                .attr("value", d => d)
                .text(d => `${d} (${teamGroups.get(d).length}Î™Ö)`);
                
            // ÌåÄ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
            teamSelect.on("change", function() {
                const selectedTeam = this.value;
                if (selectedTeam) {
                    selectTopPlayersFromTeam(selectedTeam);
                }
                // ÏÑ†ÌÉù ÌõÑ Îã§Ïãú Í∏∞Î≥∏Í∞íÏúºÎ°ú
                this.value = "";
            });
        }

        // ÌåÄÎ≥Ñ ÏÉÅÏúÑ 5Î™Ö ÏÑ†ÌÉù (Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§Ä)
        function selectTopPlayersFromTeam(teamName) {
            const teamPlayers = allPlayers
                .filter(p => p.Team === teamName)
                .sort((a, b) => b.avgMP - a.avgMP)  // ÌèâÍ∑† Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÎ†¨
                .slice(0, 5);  // Ï∂úÏ†ÑÏãúÍ∞Ñ ÏÉÅÏúÑ 5Î™Ö
            
            // Í∏∞Ï°¥ ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
            selectedPlayers = [];
            
            // Ï£ºÏ†Ñ 5Î™Ö ÏÑ†ÌÉù
            selectedPlayers = [...teamPlayers];
            
            updateSelectedLineup();
            renderPlayerList();
            updateRadarChart();
            updateAnalysis();
        }

        // ÏÑ†Ïàò Î™©Î°ù Î†åÎçîÎßÅ
        function renderPlayerList() {
            const playerListEl = d3.select("#playerList");
            
            // D3 Îç∞Ïù¥ÌÑ∞ Î∞îÏù∏Îî©ÏúºÎ°ú ÏÑ†Ïàò Î™©Î°ù ÏÉùÏÑ±
            const playerItems = playerListEl.selectAll(".player-item")
                .data(filteredPlayers)
                .join("div")
                .attr("class", "player-item")
                .classed("selected", d => selectedPlayers.some(p => p.Player === d.Player));

            playerItems.html(d => `
                <input type="checkbox" class="player-checkbox" 
                       ${selectedPlayers.some(p => p.Player === d.Player) ? 'checked' : ''}
                       ${selectedPlayers.length >= 5 && !selectedPlayers.some(p => p.Player === d.Player) ? 'disabled' : ''}>
                <div class="player-info">
                    <div class="player-name">
                        <span class="position-badge pos-${d.Pos}">${d.Pos}</span>
                        ${d.Player}
                    </div>
                    <div class="player-details">
                        ${d.Team} | ${d.pts}pts ${d.ast}ast ${d.trb}reb | ${d.avgMP}Î∂Ñ
                    </div>
                </div>
            `);

            // Ï≤¥ÌÅ¨Î∞ïÏä§ Ïù¥Î≤§Ìä∏
            playerItems.select(".player-checkbox")
                .on("change", function(event, d) {
                    if (this.checked) {
                        if (selectedPlayers.length < 5) {
                            selectedPlayers.push(d);
                        } else {
                            this.checked = false;
                            return;
                        }
                    } else {
                        selectedPlayers = selectedPlayers.filter(p => p.Player !== d.Player);
                    }
                    
                    updateSelectedLineup();
                    renderPlayerList(); // Î¶¨Î†åÎçîÎßÅ
                    updateRadarChart();
                    updateAnalysis();
                });
        }

        // ÏÑ†ÌÉùÎêú ÎùºÏù∏ÏóÖ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSelectedLineup() {
            const selectedEl = d3.select("#selectedPlayers");
            const countEl = d3.select("#selectedCount");
            
            countEl.text(selectedPlayers.length);
            
            const selectedItems = selectedEl.selectAll(".selected-player")
                .data(selectedPlayers)
                .join("div")
                .attr("class", "selected-player");

            selectedItems.html(d => `
                <div>
                    <span class="position-badge pos-${d.Pos}">${d.Pos}</span>
                    <strong>${d.Player}</strong> (${d.Team})
                    <span style="color: #666; font-size: 12px;">
                        ${d.pts}pts ${d.ast}ast ${d.trb}reb
                    </span>
                </div>
                <button class="remove-btn" onclick="removePlayer('${d.Player}')">√ó</button>
            `);
        }

        // ÏÑ†Ïàò Ï†úÍ±∞ Ìï®Ïàò
        function removePlayer(playerName) {
            selectedPlayers = selectedPlayers.filter(p => p.Player !== playerName);
            updateSelectedLineup();
            renderPlayerList();
            updateRadarChart();
            updateAnalysis();
        }

        // Í≤ÄÏÉâ Í∏∞Îä• (ÏÑ†Ïàò Ïù¥Î¶Ñ + ÌåÄ)
        d3.select("#playerSearch").on("input", function() {
            const searchTerm = this.value.toLowerCase();
            filteredPlayers = allPlayers.filter(player => 
                player.Player.toLowerCase().includes(searchTerm) ||
                player.Team.toLowerCase().includes(searchTerm)
            );
            renderPlayerList();
        });

        // Î†àÏù¥Îçî Ï∞®Ìä∏ ÏÑ§Ï†ï
        function setupRadarChart() {
            const chartGroup = svg.append("g")
                .attr("transform", `translate(${radarCenter}, ${radarCenter})`);

            // Í∑∏Î¶¨Îìú Ïõê Í∑∏Î¶¨Í∏∞
            const gridLevels = 5;
            for (let i = 1; i <= gridLevels; i++) {
                chartGroup.append("circle")
                    .attr("class", "radar-grid")
                    .attr("r", (radarRadius / gridLevels) * i);
            }

            // Ï∂ï Í∑∏Î¶¨Í∏∞
            const angleSlice = (Math.PI * 2) / stats.length;
            
            stats.forEach((stat, i) => {
                const angle = angleSlice * i - Math.PI / 2;
                const x = Math.cos(angle) * radarRadius;
                const y = Math.sin(angle) * radarRadius;
                
                // Ï∂ïÏÑ†
                chartGroup.append("line")
                    .attr("class", "radar-axis")
                    .attr("x1", 0)
                    .attr("y1", 0)
                    .attr("x2", x)
                    .attr("y2", y);
                
                // Î†àÏù¥Î∏î
                const labelX = Math.cos(angle) * (radarRadius + 20);
                const labelY = Math.sin(angle) * (radarRadius + 20);
                
                chartGroup.append("text")
                    .attr("class", "radar-label")
                    .attr("x", labelX)
                    .attr("y", labelY)
                    .attr("dy", "0.35em")
                    .text(stat.label);
            });
        }

        // Î†àÏù¥Îçî Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateRadarChart() {
            const chartGroup = svg.select("g");
            
            // Í∏∞Ï°¥ Ìå®Ïä§ Ï†úÍ±∞
            chartGroup.selectAll(".radar-path").remove();
            
            if (selectedPlayers.length === 0) return;
            
            // ÌåÄ ÌèâÍ∑† Í≥ÑÏÇ∞
            const teamAverage = {
                pts: d3.mean(selectedPlayers, d => d.pts),
                ast: d3.mean(selectedPlayers, d => d.ast),
                trb: d3.mean(selectedPlayers, d => d.trb),
                stl: d3.mean(selectedPlayers, d => d.stl),
                blk: d3.mean(selectedPlayers, d => d.blk)
            };
            
            // Ìå®Ïä§ Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± Ìï®Ïàò
            function createPath(values) {
                const angleSlice = (Math.PI * 2) / stats.length;
                let pathData = "";
                
                stats.forEach((stat, i) => {
                    const angle = angleSlice * i - Math.PI / 2;
                    const value = Math.min(values[stat.key], stat.max);
                    const radius = (value / stat.max) * radarRadius;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        pathData += `M ${x} ${y}`;
                    } else {
                        pathData += ` L ${x} ${y}`;
                    }
                });
                
                pathData += " Z";
                return pathData;
            }
            
            // Î¶¨Í∑∏ ÌèâÍ∑† Ìå®Ïä§
            chartGroup.append("path")
                .attr("class", "radar-path league-average")
                .attr("d", createPath(leagueAverage));
            
            // ÌåÄ ÌèâÍ∑† Ìå®Ïä§
            chartGroup.append("path")
                .attr("class", "radar-path")
                .attr("d", createPath(teamAverage))
                .style("opacity", 0)
                .transition()
                .duration(1000)
                .style("opacity", 1);
        }

        // Î∂ÑÏÑù ÏóÖÎç∞Ïù¥Ìä∏
        function updateAnalysis() {
            if (selectedPlayers.length === 0) {
                d3.select("#strengthAnalysis").text("ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî");
                d3.select("#weaknessAnalysis").text("ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî");
                d3.select("#statBars").html("");
                return;
            }
            
            // ÌåÄ ÌèâÍ∑† Í≥ÑÏÇ∞
            const teamAverage = {
                pts: d3.mean(selectedPlayers, d => d.pts),
                ast: d3.mean(selectedPlayers, d => d.ast),
                trb: d3.mean(selectedPlayers, d => d.trb),
                stl: d3.mean(selectedPlayers, d => d.stl),
                blk: d3.mean(selectedPlayers, d => d.blk)
            };
            
            // Ï†ÑÏ≤¥ ÌåÄ Î≤†Ïä§Ìä∏5 ÌèâÍ∑† ÎåÄÎπÑ ÎπÑÏú® Í≥ÑÏÇ∞
            const comparisons = stats.map(stat => ({
                ...stat,
                teamValue: teamAverage[stat.key],
                leagueValue: leagueAverage[stat.key],
                ratio: teamAverage[stat.key] / leagueAverage[stat.key],
                difference: teamAverage[stat.key] - leagueAverage[stat.key]
            }));
            
            // Í∞ïÏ†êÍ≥º ÏïΩÏ†ê Ï∞æÍ∏∞
            const sortedByRatio = [...comparisons].sort((a, b) => b.ratio - a.ratio);
            const strengths = sortedByRatio.slice(0, 2);
            const weaknesses = sortedByRatio.slice(-2).reverse();
            
            // Í∞ïÏ†ê ÌëúÏãú
            const strengthText = strengths.map(s => 
                `${s.label}: ${s.teamValue.toFixed(1)} (Ï†ÑÏ≤¥ ÌåÄ Ï£ºÏ†Ñ ÌèâÍ∑† ${s.ratio.toFixed(1)}Î∞∞)`
            ).join('<br>');
            d3.select("#strengthAnalysis").html(strengthText);
            
            // ÏïΩÏ†ê ÌëúÏãú
            const weaknessText = weaknesses.map(w => 
                `${w.label}: ${w.teamValue.toFixed(1)} (Ï†ÑÏ≤¥ ÌåÄ Ï£ºÏ†Ñ ÌèâÍ∑† ${w.ratio.toFixed(1)}Î∞∞)`
            ).join('<br>');
            d3.select("#weaknessAnalysis").html(weaknessText);
            
            // Îä•Î†•Ïπò Î∞î Ï∞®Ìä∏
            const statBarsEl = d3.select("#statBars");
            
            const statBars = statBarsEl.selectAll(".stat-bar")
                .data(comparisons)
                .join("div")
                .attr("class", "stat-bar");
                
            statBars.html(d => {
                const percentage = Math.min((d.ratio * 50), 100); // 50%Î•º Í∏∞Ï§ÄÏ†êÏúºÎ°ú ÏÑ§Ï†ï
                const color = d.ratio > 1.2 ? '#28a745' : d.ratio > 0.8 ? '#ffc107' : '#dc3545';
                
                return `
                    <div class="stat-label">${d.label}</div>
                    <div class="stat-progress">
                        <div class="stat-fill" style="width: ${percentage}%; background-color: ${color};"></div>
                    </div>
                    <div class="stat-value">${d.teamValue.toFixed(1)}</div>
                `;
            });
        }

        // Ï†ÑÏ≤¥ ÏÑ†ÌÉù Ìï¥Ï†ú Ìï®Ïàò
        function clearSelection() {
            selectedPlayers = [];
            updateSelectedLineup();
            renderPlayerList();
            updateRadarChart();
            updateAnalysis();
        }

        // Ï†ÑÏó≠ Ìï®ÏàòÎ°ú ÏÑ†Ïàò Ï†úÍ±∞ (HTML onclickÏóêÏÑú ÏÇ¨Ïö©)
        window.removePlayer = removePlayer;
        window.clearSelection = clearSelection;

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú Î∞è Ï¥àÍ∏∞Ìôî
        loadData();

        function loadData() {
            d3.csv("https://ilwoong100.github.io/infovis_nba_stat/data/nba_24_25.csv").then(data => {
                allPlayers = data.map(d => ({
                    ...d,
                    PTS: +d.PTS,
                    G: +d.G,
                    AST: +d.AST,
                    TRB: +d.TRB,
                    STL: +d.STL,
                    BLK: +d.BLK,
                    MP: +d.MP,
                    // Í≤ΩÍ∏∞Îãπ ÌèâÍ∑† Í≥ÑÏÇ∞
                    pts: +(d.PTS / d.G).toFixed(1),
                    ast: +(d.AST / d.G).toFixed(1),
                    trb: +(d.TRB / d.G).toFixed(1),
                    stl: +(d.STL / d.G).toFixed(1),
                    blk: +(d.BLK / d.G).toFixed(1),
                    avgMP: +(d.MP / d.G).toFixed(1)
                })).filter(d => d.Pos && d.PTS > 0 && d.G > 20)  // Ï∂©Î∂ÑÌïú Ï∂úÏ†Ñ
                .sort((a, b) => b.pts - a.pts);  // ÎìùÏ†êÏàú Ï†ïÎ†¨

                filteredPlayers = [...allPlayers];
                
                console.log("Loaded players:", allPlayers.length);
                
                calculateLeagueAverage();  // Î¶¨Í∑∏ ÌèâÍ∑† Í≥ÑÏÇ∞
                setupTeamSelect();
                renderPlayerList();
                setupRadarChart();
            }).catch(error => {
                console.error("CSV Î°úÎìú Ïã§Ìå®:", error);
            });
        }
    </script>
</body>
</html>