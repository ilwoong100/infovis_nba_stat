<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA ÏÉÅÎåÄ ÎùºÏù∏ÏóÖ Í∏∞Î∞ò ÏµúÏ†Å ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="data/nba_24_25.js"></script> 
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .main-content {
            display: flex;
            gap: 30px;
        }

        .left-panel {
            flex: 1;
            min-width: 400px;
        }

        .right-panel {
            flex: 1;
            min-width: 600px;
        }

        .opponent-setup {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .opponent-setup h3 {
            margin: 0 0 15px 0;
            color: #856404;
            text-align: center;
        }

        .team-selection {
            margin-bottom: 15px;
        }

        .team-selection label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .team-selection select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }

        .position-selectors {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .position-group {
            margin-bottom: 10px;
        }

        .position-group label {
            display: block;
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .position-group select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }

        .position-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }

        .pos-PG { background-color: #FF6B6B; }
        .pos-SG { background-color: #4ECDC4; }
        .pos-SF { background-color: #45B7D1; }
        .pos-PF { background-color: #96CEB4; }
        .pos-C { background-color: #FFEAA7; color: #333; }

        .analyze-btn {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }

        .analyze-btn:hover {
            background: #0056b3;
        }

        .analyze-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .opponent-analysis {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .opponent-analysis h4 {
            margin: 0 0 10px 0;
            color: #721c24;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        .recommendation-panel {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
        }

        .recommendation-panel h3 {
            margin: 0 0 15px 0;
            color: #155724;
            text-align: center;
        }

        .strategy-summary {
            background: #e2e3e5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .strategy-summary h5 {
            margin: 0 0 10px 0;
            color: #383d41;
        }

        .recommended-lineup {
            background: white;
            border-radius: 5px;
            overflow: hidden;
        }

        .lineup-header {
            background: #28a745;
            color: white;
            padding: 10px;
            font-weight: bold;
            text-align: center;
        }

        .player-recommendation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .player-recommendation:last-child {
            border-bottom: none;
        }

        .player-recommendation:nth-child(even) {
            background: #f8f9fa;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #333;
        }

        .player-stats {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        .recommendation-reason {
            font-size: 11px;
            color: #28a745;
            margin-left: 15px;
            max-width: 150px;
        }

        .matchup-chart {
            margin-top: 20px;
            text-align: center;
        }

        .matchup-comparison {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .our-team {
            color: #28a745;
            font-weight: bold;
        }

        .opponent-team {
            color: #dc3545;
            font-weight: bold;
        }

        .advantage {
            color: #28a745;
            font-size: 12px;
        }

        .disadvantage {
            color: #dc3545;
            font-size: 12px;
        }

        .neutral {
            color: #6c757d;
            font-size: 12px;
        }

        .radar-container {
            text-align: center;
            margin-top: 20px;
        }

        .radar-chart {
            margin: 0 auto;
        }

        .radar-path {
            fill: rgba(54, 162, 235, 0.2);
            stroke: rgba(54, 162, 235, 1);
            stroke-width: 2;
        }

        .radar-path.opponent {
            fill: rgba(255, 99, 132, 0.2);
            stroke: rgba(255, 99, 132, 1);
            stroke-width: 2;
        }

        .radar-axis {
            stroke: #999;
            stroke-width: 1;
        }

        .radar-grid {
            stroke: #ddd;
            stroke-width: 1;
            fill: none;
        }

        .radar-label {
            font-size: 12px;
            font-weight: bold;
            fill: #333;
            text-anchor: middle;
        }

        .legend {
            text-align: center;
            margin-top: 15px;
        }

        .legend-item {
            display: inline-block;
            margin: 0 15px;
            font-size: 14px;
        }

        .legend-line {
            display: inline-block;
            width: 20px;
            height: 3px;
            margin-right: 5px;
            vertical-align: middle;
        }

        .our-lineup { background-color: rgba(54, 162, 235, 1); }
        .opponent-lineup { background-color: rgba(255, 99, 132, 1); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÄ NBA ÏÉÅÎåÄ ÎùºÏù∏ÏóÖ Í∏∞Î∞ò ÏµúÏ†Å ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú</h1>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="opponent-setup">
                    <h3>ÎùºÏù∏ÏóÖ ÏÑ§Ï†ï</h3>
                    
                    <div class="team-selection">
                        <label>Ïö∞Î¶¨ÌåÄ ÏÑ†ÌÉù</label>
                        <select id="ourTeamSelect">
                            <option value="">ÌåÄ ÏÑ†ÌÉù</option>
                        </select>
                    </div>
                    
                    <div class="team-selection">
                        <label>ÏÉÅÎåÄÌåÄ ÏÑ†ÌÉù (Îπ†Î•∏ ÏÑ§Ï†ï)</label>
                        <select id="opponentTeamSelect">
                            <option value="">ÌåÄ ÏÑ†ÌÉù (ÏÑ†ÌÉùÏÇ¨Ìï≠)</option>
                        </select>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">ÏÉÅÎåÄÌåÄ ÎùºÏù∏ÏóÖ (5Î™Ö ÏÑ†ÌÉù)</label>
                        <input type="text" id="playerSearch" placeholder="ÏÑ†Ïàò Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ..." style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 3px;">
                        <div id="playerPool" style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; background: white;"></div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <h5 style="margin: 0 0 10px 0; color: #856404;">ÏÑ†ÌÉùÎêú ÏÉÅÎåÄ ÎùºÏù∏ÏóÖ (<span id="opponentCount">0</span>/5)</h5>
                        <div id="selectedOpponents" style="min-height: 50px; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 5px;"></div>
                    </div>
                    
                    <button class="analyze-btn" id="analyzeBtn" onclick="analyzeMatchup()">ÏÉÅÎåÄ Î∂ÑÏÑù Î∞è ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú</button>
                </div>
                
                <div class="opponent-analysis" id="opponentAnalysis" style="display: none;">
                    <h4>üîç ÏÉÅÎåÄÌåÄ Î∂ÑÏÑù</h4>
                    <div class="analysis-grid" id="opponentStats"></div>
                    <div id="opponentStrengths"></div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="recommendation-panel" id="recommendationPanel" style="display: none;">
                    <h3>üí° Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ</h3>
                    
                    <div class="strategy-summary">
                        <h5>Ï†ÑÎûµ ÏöîÏïΩ</h5>
                        <div id="strategySummary">ÏÉÅÎåÄÌåÄÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.</div>
                    </div>
                    
                    <div class="recommended-lineup">
                        <div class="lineup-header">Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ</div>
                        <div id="recommendedPlayers"></div>
                    </div>
                    
                    <div class="matchup-chart">
                        <h5>Îß§ÏπòÏóÖ ÎπÑÍµê</h5>
                        <div id="matchupComparison"></div>
                    </div>
                </div>
                
                <div class="radar-container" id="radarContainer" style="display: none;">
                    <h4>ÎùºÏù∏ÏóÖ Îä•Î†•Ïπò ÎπÑÍµê</h4>
                    <svg class="radar-chart" id="comparisonRadar"></svg>
                    <div class="legend">
                        <div class="legend-item">
                            <span class="legend-line our-lineup"></span>
                            Ïö∞Î¶¨ Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ
                        </div>
                        <div class="legend-item">
                            <span class="legend-line opponent-lineup"></span>
                            ÏÉÅÎåÄÌåÄ ÎùºÏù∏ÏóÖ
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // D3.js Ïä§ÌÉÄÏùº Ï†ÑÏó≠ ÏÑ§Ï†ï
        const radarSize = 350;
        const radarRadius = 120;
        const radarCenter = radarSize / 2;

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let allPlayers = [];
        let opponentLineup = [];
        let recommendedLineup = [];
        let ourTeamPlayers = []; // Ïö∞Î¶¨ÌåÄ ÏÑ†ÏàòÌíÄ
        let filteredPlayers = []; // Í≤ÄÏÉâ ÌïÑÌÑ∞ÎßÅÎêú ÏÑ†ÏàòÎì§

        // Îä•Î†•Ïπò Ï†ïÏùò
        const stats = [
            { key: 'pts', label: 'ÎìùÏ†ê', max: 35 },
            { key: 'ast', label: 'Ïñ¥ÏãúÏä§Ìä∏', max: 12 },
            { key: 'trb', label: 'Î¶¨Î∞îÏö¥Îìú', max: 15 },
            { key: 'stl', label: 'Ïä§Ìã∏', max: 3 },
            { key: 'blk', label: 'Î∏îÎ°ù', max: 3 }
        ];


        // ÏÑ†ÌÉùÏûê ÏÑ§Ï†ï
        function setupSelectors() {
            // ÌåÄ Î™©Î°ù ÏÉùÏÑ±
            const teams = [...new Set(allPlayers.map(d => d.Team))].sort();
            
            // Ïö∞Î¶¨ÌåÄ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥
            const ourTeamSelect = d3.select("#ourTeamSelect");
            ourTeamSelect.selectAll("option.team-option")
                .data(teams)
                .join("option")
                .attr("class", "team-option")
                .attr("value", d => d)
                .text(d => d);
            
            // Ïö∞Î¶¨ÌåÄ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
            ourTeamSelect.on("change", function() {
                ourTeam = this.value;
                if (ourTeam) {
                    ourTeamPlayers = allPlayers.filter(d => d.Team === ourTeam);
                    console.log("Our team players:", ourTeamPlayers.length);
                } else {
                    ourTeamPlayers = [];
                }
                updateAnalyzeButton();
            });
            
            // ÏÉÅÎåÄÌåÄ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥
            const opponentTeamSelect = d3.select("#opponentTeamSelect");
            opponentTeamSelect.selectAll("option.team-option")
                .data(teams)
                .join("option")
                .attr("class", "team-option")
                .attr("value", d => d)
                .text(d => d);
            
            // ÏÉÅÎåÄÌåÄ ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ (D3 Î∞©ÏãùÏúºÎ°ú Î≥µÏõê)
            opponentTeamSelect.on("change", function() {
                const selectedTeam = this.value;
                console.log("ÏÉÅÎåÄÌåÄ ÎìúÎ°≠Îã§Ïö¥ Î≥ÄÍ≤Ω:", selectedTeam);
                
                if (selectedTeam) {
                    console.log("ÌåÄÏù¥ ÏÑ†ÌÉùÎê® - ÌïÑÌÑ∞ÎßÅ ÏãúÏûë");
                    
                    // 1. Í≤ÄÏÉâÏ∞Ω Ï¥àÍ∏∞Ìôî
                    d3.select("#playerSearch").property("value", "");
                    
                    // 2. Ìï¥Îãπ ÌåÄ ÏÑ†ÏàòÎì§Î°ú ÌïÑÌÑ∞ÎßÅ
                    filteredPlayers = allPlayers.filter(d => d.Team === selectedTeam);
                    console.log("ÌïÑÌÑ∞ÎßÅ ÏôÑÎ£å:", filteredPlayers.length, "Î™Ö");
                    console.log("ÌåÄ ÏÑ†ÏàòÎì§:", filteredPlayers.map(p => p.Player));
                    
                    // 3. ÏÉÅÏúÑ 5Î™Ö ÏûêÎèô ÏÑ†ÌÉù
                    const top5 = filteredPlayers
                        .sort((a, b) => b.avgMP - a.avgMP)
                        .slice(0, 5);
                    opponentLineup = [...top5];
                    console.log("ÏûêÎèô ÏÑ†ÌÉùÎêú 5Î™Ö:", opponentLineup.map(p => p.Player));
                    
                    // 4. UI ÏóÖÎç∞Ïù¥Ìä∏
                    updateSelectedOpponents();
                    renderPlayerPool();
                    updateAnalyzeButton();
                    
                } else {
                    console.log("ÌåÄ ÏÑ†ÌÉù Ìï¥Ï†ú - Ï†ÑÏ≤¥ ÌëúÏãú");
                    opponentLineup = [];
                    filteredPlayers = [...allPlayers];
                    updateSelectedOpponents();
                    renderPlayerPool();
                    updateAnalyzeButton();
                }
            });

            // Ï¥àÍ∏∞ ÏÑ†ÏàòÌíÄ ÏÑ§Ï†ï (D3 Î∞©Ïãù)
            filteredPlayers = [...allPlayers];
            renderPlayerPool();
            
            // Í≤ÄÏÉâ Í∏∞Îä• (D3 Î∞©Ïãù)
            d3.select("#playerSearch").on("input", function() {
                const searchTerm = this.value.toLowerCase();
                const selectedTeam = d3.select("#opponentTeamSelect").property("value");
                
                console.log("Í≤ÄÏÉâÏñ¥:", searchTerm, "ÏÑ†ÌÉùÎêú ÌåÄ:", selectedTeam);
                
                // Í∏∞Î≥∏ ÌïÑÌÑ∞
                let baseFilter;
                if (selectedTeam) {
                    baseFilter = allPlayers.filter(d => d.Team === selectedTeam);
                } else {
                    baseFilter = [...allPlayers];
                }
                
                // Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ÎßÅ
                if (searchTerm) {
                    filteredPlayers = baseFilter.filter(player => 
                        player.Player.toLowerCase().includes(searchTerm)
                    );
                } else {
                    filteredPlayers = baseFilter;
                }
                
                renderPlayerPool();
            });
        }

        // ÏÑ†ÏàòÌíÄ Î†åÎçîÎßÅ
        function renderPlayerPool() {
            const playerPool = d3.select("#playerPool");
            
            const playerItems = playerPool.selectAll(".player-item")
                .data(filteredPlayers)
                .join("div")
                .attr("class", "player-item")
                .style("padding", "8px")
                .style("border-bottom", "1px solid #eee")
                .style("cursor", "pointer")
                .style("transition", "background 0.2s")
                .classed("selected", d => opponentLineup.some(p => p.Player === d.Player));

            playerItems.html(d => `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span class="position-badge pos-${d.Pos}">${d.Pos}</span>
                        <strong>${d.Player}</strong> (${d.Team})
                    </div>
                    <div style="font-size: 12px; color: #666;">
                        ${d.pts}pts ${d.ast}ast ${d.trb}reb
                    </div>
                </div>
            `);

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
            playerItems.on("click", function(event, d) {
                const isSelected = opponentLineup.some(p => p.Player === d.Player);
                
                if (isSelected) {
                    // ÏÑ†ÌÉù Ìï¥Ï†ú
                    opponentLineup = opponentLineup.filter(p => p.Player !== d.Player);
                } else {
                    // ÏÑ†ÌÉù Ï∂îÍ∞Ä (ÏµúÎåÄ 5Î™Ö)
                    if (opponentLineup.length < 5) {
                        opponentLineup.push(d);
                    } else {
                        alert("ÏµúÎåÄ 5Î™ÖÍπåÏßÄÎßå ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.");
                        return;
                    }
                }
                
                updateSelectedOpponents();
                renderPlayerPool(); // ÏÑ†ÌÉù ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                updateAnalyzeButton();
            });

            // Ìò∏Î≤Ñ Ìö®Í≥º
            playerItems
                .on("mouseover", function() {
                    d3.select(this).style("background", "#f0f8ff");
                })
                .on("mouseout", function() {
                    const isSelected = d3.select(this).classed("selected");
                    d3.select(this).style("background", isSelected ? "#e3f2fd" : "white");
                });

            // ÏÑ†ÌÉùÎêú Ìï≠Î™© Î∞∞Í≤ΩÏÉâ
            playerItems.filter(d => opponentLineup.some(p => p.Player === d.Player))
                .style("background", "#e3f2fd");
        }

        // ÏÑ†ÌÉùÎêú ÏÉÅÎåÄ ÎùºÏù∏ÏóÖ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSelectedOpponents() {
            d3.select("#opponentCount").text(opponentLineup.length);
            
            const selectedEl = d3.select("#selectedOpponents");
            
            if (opponentLineup.length === 0) {
                selectedEl.html('<div style="color: #666; font-style: italic;">ÏÑ†ÏàòÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</div>');
                return;
            }
            
            const selectedItems = selectedEl.selectAll(".selected-opponent")
                .data(opponentLineup)
                .join("div")
                .attr("class", "selected-opponent")
                .style("display", "flex")
                .style("justify-content", "space-between")
                .style("align-items", "center")
                .style("padding", "5px 0")
                .style("border-bottom", "1px solid #ffeaa7");

            selectedItems.html(d => `
                <div>
                    <span class="position-badge pos-${d.Pos}">${d.Pos}</span>
                    <strong>${d.Player}</strong> (${d.Team})
                    <span style="color: #666; font-size: 12px;"> - ${d.pts}pts ${d.ast}ast ${d.trb}reb</span>
                </div>
                <button onclick="removeOpponent('${d.Player}')" style="background: #dc3545; color: white; border: none; border-radius: 3px; padding: 2px 6px; font-size: 12px; cursor: pointer;">√ó</button>
            `);
        }

        // ÏÉÅÎåÄ ÏÑ†Ïàò Ï†úÍ±∞
        function removeOpponent(playerName) {
            opponentLineup = opponentLineup.filter(p => p.Player !== playerName);
            updateSelectedOpponents();
            renderPlayerPool();
            updateAnalyzeButton();
        }

        // ÌåÄÎ≥Ñ ÎùºÏù∏ÏóÖ ÏûêÎèô ÏÑ§Ï†ï
        function fillTeamLineup(teamName) {
            const teamPlayers = allPlayers.filter(d => d.Team === teamName);
            
            ['PG', 'SG', 'SF', 'PF', 'C'].forEach(position => {
                const positionPlayer = teamPlayers
                    .filter(d => d.Pos === position)
                    .sort((a, b) => b.avgMP - a.avgMP)[0]; // Ï∂úÏ†ÑÏãúÍ∞Ñ Í∏∞Ï§Ä ÏµúÍ≥† ÏÑ†Ïàò
                
                if (positionPlayer) {
                    d3.select(`#opponent-${position}`)
                        .property("value", positionPlayer.Player);
                }
            });
            
            updateAnalyzeButton();
        }

        // Î∂ÑÏÑù Î≤ÑÌäº ÌôúÏÑ±Ìôî Ï≤¥ÌÅ¨
        function updateAnalyzeButton() {
            const analyzeBtn = d3.select("#analyzeBtn");
            
            if (!ourTeam) {
                analyzeBtn.property("disabled", true)
                    .text("Ïö∞Î¶¨ÌåÄÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî");
            } else if (opponentLineup.length !== 5) {
                analyzeBtn.property("disabled", true)
                    .text(`ÏÉÅÎåÄ ÏÑ†Ïàò ÏÑ†ÌÉù (${opponentLineup.length}/5)`);
            } else {
                analyzeBtn.property("disabled", false)
                    .text("ÏÉÅÎåÄ Î∂ÑÏÑù Î∞è ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú");
            }
        }

        // Îß§ÏπòÏóÖ Î∂ÑÏÑù Î©îÏù∏ Ìï®Ïàò
        function analyzeMatchup() {
            if (!ourTeam) {
                alert("Ïö∞Î¶¨ÌåÄÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }
            
            if (opponentLineup.length !== 5) {
                alert("ÏÉÅÎåÄÌåÄ 5Î™ÖÏùò ÏÑ†ÏàòÎ•º Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
                return;
            }
            
            // ÏÉÅÎåÄÌåÄ Î∂ÑÏÑù
            analyzeOpponent();
            
            // ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú
            recommendLineup();
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            showAnalysis();
            setupComparisonRadar();
        }

        // ÏÉÅÎåÄÌåÄ Î∂ÑÏÑù
        function analyzeOpponent() {
            const opponentStats = {
                avgPts: d3.mean(opponentLineup, d => d.pts),
                avgAst: d3.mean(opponentLineup, d => d.ast),
                avgTrb: d3.mean(opponentLineup, d => d.trb),
                avgStl: d3.mean(opponentLineup, d => d.stl),
                avgBlk: d3.mean(opponentLineup, d => d.blk),
                avgThreeP: d3.mean(opponentLineup, d => d.threeP),
                avgFG: d3.mean(opponentLineup, d => d.fieldGoal)
            };

            // ÏÉÅÎåÄÌåÄ Î∂ÑÏÑù UI ÏóÖÎç∞Ïù¥Ìä∏
            const statsGrid = d3.select("#opponentStats");
            
            const statCards = [
                { label: "ÌèâÍ∑† ÎìùÏ†ê", value: opponentStats.avgPts.toFixed(1) },
                { label: "ÌèâÍ∑† Ïñ¥ÏãúÏä§Ìä∏", value: opponentStats.avgAst.toFixed(1) },
                { label: "ÌèâÍ∑† Î¶¨Î∞îÏö¥Îìú", value: opponentStats.avgTrb.toFixed(1) },
                { label: "3Ï†ê ÏÑ±Í≥µÎ•†", value: (opponentStats.avgThreeP * 100).toFixed(1) + "%" }
            ];

            statsGrid.selectAll(".stat-card")
                .data(statCards)
                .join("div")
                .attr("class", "stat-card")
                .html(d => `
                    <div class="stat-value">${d.value}</div>
                    <div class="stat-label">${d.label}</div>
                `);

            // ÏÉÅÎåÄÌåÄ Í∞ïÏ†ê Î∂ÑÏÑù
            const strengths = [];
            if (opponentStats.avgPts > 20) strengths.push("Í∞ïÎ†•Ìïú ÎìùÏ†êÎ†•");
            if (opponentStats.avgAst > 6) strengths.push("Îõ∞Ïñ¥ÎÇú ÌîåÎ†àÏù¥Î©îÏù¥ÌÇπ");
            if (opponentStats.avgTrb > 8) strengths.push("Î¶¨Î∞îÏö¥Îìú Ïö∞ÏúÑ");
            if (opponentStats.avgThreeP > 0.38) strengths.push("3Ï†ê ÏäàÌåÖ ÏúÑÌòë");
            if (opponentStats.avgBlk > 1.5) strengths.push("Î∏îÎ°ùÏÉ∑ ÏàòÎπÑ");

            d3.select("#opponentStrengths")
                .html(`<strong>Ï£ºÏöî Í∞ïÏ†ê:</strong> ${strengths.join(", ") || "Í∑†ÌòïÏû°Ìûå ÌåÄ"}`);
        }

        // ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú ÏïåÍ≥†Î¶¨Ï¶ò (Ìè¨ÏßÄÏÖò Ï†úÏïΩ ÏôÑÏ†Ñ Ï†úÍ±∞)
        function recommendLineup() {
            console.log("=== ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú ÏãúÏûë ===");
            
            const opponentStats = {
                avgPts: d3.mean(opponentLineup, d => d.pts),
                avgAst: d3.mean(opponentLineup, d => d.ast),
                avgTrb: d3.mean(opponentLineup, d => d.trb),
                avgStl: d3.mean(opponentLineup, d => d.stl),
                avgBlk: d3.mean(opponentLineup, d => d.blk),
                avgThreeP: d3.mean(opponentLineup, d => d.threeP)
            };

            console.log("ÏÉÅÎåÄÌåÄ ÌèâÍ∑† Ïä§ÌÉØ:", opponentStats);

            // Í∞Å ÏÑ†ÏàòÏóêÍ≤å Ï†êÏàò Î∂ÄÏó¨
            const scoredPlayers = ourTeamPlayers.map(player => {
                let score = 0;
                let reasons = [];

                // Í∏∞Î≥∏ Îä•Î†•Ïπò Ï†êÏàò (Í∞ÄÏ§ëÏπò Ï†ÅÏö©)
                score += player.pts * 1.5; // ÎìùÏ†ê
                score += player.ast * 2.0;  // Ïñ¥ÏãúÏä§Ìä∏
                score += player.trb * 1.5;  // Î¶¨Î∞îÏö¥Îìú
                score += player.stl * 3.0;  // Ïä§Ìã∏
                score += player.blk * 3.0;  // Î∏îÎ°ù

                // ÏÉÅÎåÄÎ∞© ÌäπÏÑ±Ïóê Îî∞Î•∏ Ï†ÑÎûµÏ†Å Î≥¥ÎÑàÏä§
                if (opponentStats.avgPts > 20) {
                    if (player.stl > 1.0) {
                        score += 15;
                        reasons.push("ÏàòÎπÑÎ†•");
                    }
                    if (player.blk > 1.0) {
                        score += 12;
                        reasons.push("Î∏îÎ°ùÏÉ∑");
                    }
                }

                if (opponentStats.avgThreeP > 0.38) {
                    if (player.stl > 1.0) {
                        score += 18;
                        reasons.push("ÌéòÎ¶¨ÎØ∏ÌÑ∞ ÏàòÎπÑ");
                    }
                }

                if (opponentStats.avgTrb > 8) {
                    if (player.trb > 6) {
                        score += 15;
                        reasons.push("Î¶¨Î∞îÏö¥Îìú ÎåÄÏùë");
                    }
                }

                if (opponentStats.avgAst > 6) {
                    if (player.stl > 1.2) {
                        score += 12;
                        reasons.push("ÌîåÎ†àÏù¥ Ï∞®Îã®");
                    }
                }

                // Ï∂úÏ†ÑÏãúÍ∞Ñ Í≥†Î†§ (Ï£ºÏ†ÑÍ∏â Ïö∞ÎåÄ)
                if (player.avgMP > 30) {
                    score += 8;
                    reasons.push("Ï£ºÏ†ÑÍ∏â");
                } else if (player.avgMP > 20) {
                    score += 4;
                    reasons.push("Î°úÌÖåÏù¥ÏÖò");
                }

                // 3Ï†ê ÏäàÌåÖ Îä•Î†•
                if (player.threeP > 0.35) {
                    score += 5;
                    reasons.push("3Ï†êÏäàÌåÖ");
                }

                return {
                    ...player,
                    matchupScore: score,
                    reasons: reasons
                };
            });

            // Ï†êÏàò ÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÏó¨ ÏÉÅÏúÑ 5Î™Ö ÏÑ†ÌÉù (Ìè¨ÏßÄÏÖò ÏôÑÏ†Ñ Î¨¥Ïãú)
            recommendedLineup = scoredPlayers
                .sort((a, b) => b.matchupScore - a.matchupScore)
                .slice(0, 5);
                
            console.log("Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ (Ï†êÏàò Í∏∞Ï§Ä):");
            recommendedLineup.forEach((player, index) => {
                console.log(`${index + 1}. ${player.Player} (${player.Pos}) - ${player.matchupScore.toFixed(1)}Ï†ê - ${player.reasons.join(", ")}`);
            });

            // Ìè¨ÏßÄÏÖò Î∂ÑÌè¨ ÌôïÏù∏
            const positionCount = {};
            recommendedLineup.forEach(player => {
                positionCount[player.Pos] = (positionCount[player.Pos] || 0) + 1;
            });
            console.log("Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ Ìè¨ÏßÄÏÖò Î∂ÑÌè¨:", positionCount);
            
            console.log("=== ÎùºÏù∏ÏóÖ Ï∂îÏ≤ú ÏôÑÎ£å ===");
        }

        // Î∂ÑÏÑù Í≤∞Í≥º ÌëúÏãú
        function showAnalysis() {
            // Ìå®ÎÑê ÌëúÏãú
            d3.select("#opponentAnalysis").style("display", "block");
            d3.select("#recommendationPanel").style("display", "block");
            d3.select("#radarContainer").style("display", "block");

            // Ï†ÑÎûµ ÏöîÏïΩ
            const strategy = generateStrategy();
            d3.select("#strategySummary").html(strategy);

            // Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ ÌëúÏãú
            const playersHtml = recommendedLineup.map(player => `
                <div class="player-recommendation">
                    <div class="player-info">
                        <div class="player-name">
                            <span class="position-badge pos-${player.Pos}">${player.Pos}</span>
                            ${player.Player}
                        </div>
                        <div class="player-stats">
                            ${player.pts}pts ${player.ast}ast ${player.trb}reb | ${player.Team}
                        </div>
                    </div>
                    <div class="recommendation-reason">
                        ${player.reasons.slice(0, 2).join(", ")}
                    </div>
                </div>
            `).join("");

            d3.select("#recommendedPlayers").html(playersHtml);

            // Îß§ÏπòÏóÖ ÎπÑÍµê
            showMatchupComparison();
        }

        // Ï†ÑÎûµ ÏÉùÏÑ±
        function generateStrategy() {
            const opponentStats = {
                avgPts: d3.mean(opponentLineup, d => d.pts),
                avgAst: d3.mean(opponentLineup, d => d.ast),
                avgTrb: d3.mean(opponentLineup, d => d.trb),
                avgThreeP: d3.mean(opponentLineup, d => d.threeP)
            };

            let strategy = "";

            if (opponentStats.avgPts > 20) {
                strategy += "‚Ä¢ <strong>ÏàòÎπÑ Í∞ïÌôî:</strong> ÏÉÅÎåÄÏùò Í∞ïÌïú ÎìùÏ†êÎ†•Ïóê ÎåÄÏùëÌïòÏó¨ ÏàòÎπÑÌòï ÏÑ†ÏàòÎì§Î°ú Íµ¨ÏÑ±<br>";
            }

            if (opponentStats.avgThreeP > 0.38) {
                strategy += "‚Ä¢ <strong>ÌéòÎ¶¨ÎØ∏ÌÑ∞ ÏàòÎπÑ:</strong> 3Ï†ê ÏäàÌåÖÏùÑ Ï∞®Îã®Ìï† Ïàò ÏûàÎäî Ïô∏Í≥Ω ÏàòÎπÑÏàò Î∞∞Ïπò<br>";
            }

            if (opponentStats.avgTrb > 8) {
                strategy += "‚Ä¢ <strong>Î¶¨Î∞îÏö¥Îìú Í≤ΩÏüÅ:</strong> Î¶¨Î∞îÏö¥Îìú Ïö∞ÏúÑÎ•º ÏúÑÌïú Ïû•Ïã† ÏÑ†ÏàòÎì§ Ìà¨ÏûÖ<br>";
            }

            if (opponentStats.avgAst > 6) {
                strategy += "‚Ä¢ <strong>ÌîåÎ†àÏù¥ Ï∞®Îã®:</strong> ÏÉÅÎåÄ ÌîåÎ†àÏù¥Î©îÏù¥ÌÇπÏùÑ Î∞©Ìï¥Ìï† Ïàò ÏûàÎäî Ïä§Ìã∏ Ï†ÑÎ¨∏Í∞Ä ÌôúÏö©<br>";
            }

            return strategy || "‚Ä¢ <strong>Í∑†Ìòï ÎùºÏù∏ÏóÖ:</strong> ÏÉÅÎåÄÌåÄÏóê ÌäπÎ≥ÑÌïú ÏïΩÏ†êÏù¥ ÏóÜÏñ¥ Î∞∏Îü∞Ïä§ Ïû°Ìûå Íµ¨ÏÑ±ÏúºÎ°ú ÎåÄÏùë";
        }

        // Îß§ÏπòÏóÖ ÎπÑÍµê ÌëúÏãú
        function showMatchupComparison() {
            const ourStats = {
                pts: d3.mean(recommendedLineup, d => d.pts),
                ast: d3.mean(recommendedLineup, d => d.ast),
                trb: d3.mean(recommendedLineup, d => d.trb),
                stl: d3.mean(recommendedLineup, d => d.stl),
                blk: d3.mean(recommendedLineup, d => d.blk)
            };

            const opponentStats = {
                pts: d3.mean(opponentLineup, d => d.pts),
                ast: d3.mean(opponentLineup, d => d.ast),
                trb: d3.mean(opponentLineup, d => d.trb),
                stl: d3.mean(opponentLineup, d => d.stl),
                blk: d3.mean(opponentLineup, d => d.blk)
            };

            const comparisons = [
                { stat: "ÎìùÏ†ê", our: ourStats.pts, opponent: opponentStats.pts },
                { stat: "Ïñ¥ÏãúÏä§Ìä∏", our: ourStats.ast, opponent: opponentStats.ast },
                { stat: "Î¶¨Î∞îÏö¥Îìú", our: ourStats.trb, opponent: opponentStats.trb },
                { stat: "Ïä§Ìã∏", our: ourStats.stl, opponent: opponentStats.stl },
                { stat: "Î∏îÎ°ù", our: ourStats.blk, opponent: opponentStats.blk }
            ];

            const comparisonHtml = comparisons.map(comp => {
                const diff = comp.our - comp.opponent;
                const advantage = Math.abs(diff) < 0.5 ? "neutral" : (diff > 0 ? "advantage" : "disadvantage");
                const symbol = advantage === "advantage" ? "‚Üë" : (advantage === "disadvantage" ? "‚Üì" : "=");

                return `
                    <div class="matchup-comparison">
                        <span class="our-team">${comp.our.toFixed(1)}</span>
                        <span class="${advantage}">${comp.stat} ${symbol}</span>
                        <span class="opponent-team">${comp.opponent.toFixed(1)}</span>
                    </div>
                `;
            }).join("");

            d3.select("#matchupComparison").html(comparisonHtml);
        }

        // ÎπÑÍµê Î†àÏù¥Îçî Ï∞®Ìä∏ ÏÑ§Ï†ï
        function setupComparisonRadar() {
            const svg = d3.select("#comparisonRadar")
                .attr("width", radarSize)
                .attr("height", radarSize);

            // Í∏∞Ï°¥ Ï∞®Ìä∏ ÏßÄÏö∞Í∏∞
            svg.selectAll("*").remove();

            const chartGroup = svg.append("g")
                .attr("transform", `translate(${radarCenter}, ${radarCenter})`);

            // Í∑∏Î¶¨Îìú Ïõê Í∑∏Î¶¨Í∏∞
            const gridLevels = 5;
            for (let i = 1; i <= gridLevels; i++) {
                chartGroup.append("circle")
                    .attr("class", "radar-grid")
                    .attr("r", (radarRadius / gridLevels) * i);
            }

            // Ï∂ï Í∑∏Î¶¨Í∏∞
            const angleSlice = (Math.PI * 2) / stats.length;
            
            stats.forEach((stat, i) => {
                const angle = angleSlice * i - Math.PI / 2;
                const x = Math.cos(angle) * radarRadius;
                const y = Math.sin(angle) * radarRadius;
                
                // Ï∂ïÏÑ†
                chartGroup.append("line")
                    .attr("class", "radar-axis")
                    .attr("x1", 0)
                    .attr("y1", 0)
                    .attr("x2", x)
                    .attr("y2", y);
                
                // Î†àÏù¥Î∏î
                const labelX = Math.cos(angle) * (radarRadius + 25);
                const labelY = Math.sin(angle) * (radarRadius + 25);
                
                chartGroup.append("text")
                    .attr("class", "radar-label")
                    .attr("x", labelX)
                    .attr("y", labelY)
                    .attr("dy", "0.35em")
                    .text(stat.label);
            });

            // Îç∞Ïù¥ÌÑ∞ Ìå®Ïä§ ÏÉùÏÑ±
            function createRadarPath(players, className) {
                const values = {
                    pts: d3.mean(players, d => d.pts),
                    ast: d3.mean(players, d => d.ast),
                    trb: d3.mean(players, d => d.trb),
                    stl: d3.mean(players, d => d.stl),
                    blk: d3.mean(players, d => d.blk)
                };

                let pathData = "";
                stats.forEach((stat, i) => {
                    const angle = angleSlice * i - Math.PI / 2;
                    const value = Math.min(values[stat.key], stat.max);
                    const radius = (value / stat.max) * radarRadius;
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        pathData += `M ${x} ${y}`;
                    } else {
                        pathData += ` L ${x} ${y}`;
                    }
                });
                pathData += " Z";

                chartGroup.append("path")
                    .attr("class", `radar-path ${className}`)
                    .attr("d", pathData)
                    .style("opacity", 0)
                    .transition()
                    .duration(1000)
                    .style("opacity", 1);
            }

            // ÏÉÅÎåÄÌåÄ ÎùºÏù∏ÏóÖ
            createRadarPath(opponentLineup, "opponent");
            
            // Ïö∞Î¶¨ÌåÄ Ï∂îÏ≤ú ÎùºÏù∏ÏóÖ
            createRadarPath(recommendedLineup, "");
        }

        // Ï†ÑÏó≠ Ìï®Ïàò
        window.analyzeMatchup = analyzeMatchup;
        window.removeOpponent = removeOpponent;

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú Î∞è Ï¥àÍ∏∞Ìôî
        loadData();

        function loadData() {
            // D3 CSV Î°úÎìú ÎåÄÏã† ÏßÅÏ†ë Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©
            const data = window.nba_data; // nba_24_25.jsÏóêÏÑú Î°úÎìúÎêú Îç∞Ïù¥ÌÑ∞
            rawData = data.map(d => ({
                ...d,
                PTS: +d.PTS,
                G: +d.G,
                AST: +d.AST,
                TRB: +d.TRB,
                STL: +d.STL,
                BLK: +d.BLK,
                MP: +d.MP,
                threeP: +d['3P%'],
                freeThrow: +d['FT%'],
                fieldGoal: +d['FG%'],
                // Í≤ΩÍ∏∞Îãπ ÌèâÍ∑† Í≥ÑÏÇ∞
                pts: +(d.PTS / d.G).toFixed(1),
                ast: +(d.AST / d.G).toFixed(1),
                trb: +(d.TRB / d.G).toFixed(1),
                stl: +(d.STL / d.G).toFixed(1),
                blk: +(d.BLK / d.G).toFixed(1),
                avgMP: +(d.MP / d.G).toFixed(1)
            })).filter(d => d.Pos && d.PTS > 0 && d.G > 20);

            // Ïö∞Î¶¨ÌåÄ ÏÑ†ÏàòÎì§ ÌïÑÌÑ∞ÎßÅ (Ï¥àÍ∏∞ÏóêÎäî ÎπÑÏñ¥ÏûàÏùå)
            ourTeamPlayers = [];
            
            console.log("Loaded players:", allPlayers.length);
            
            setupSelectors();

        }
    </script>
</body>
</html>